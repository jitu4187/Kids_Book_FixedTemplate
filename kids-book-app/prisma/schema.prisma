// Prisma data model for storing personalization inputs and generated assets.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model ChildProfile {
  id             String   @id @default(cuid())
  firstName      String
  age            Int?
  guardianEmail  String   @unique
  dreamJob       String?
  favoriteThings String?  // JSON string until we move to Postgres
  specialNotes   String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  stories        Story[]
}

model Story {
  id                   String          @id @default(cuid())
  title                String
  templateId           String
  status               String          @default("DRAFT")
  personalizationNotes String?
  scenes               String?         // JSON string describing generated scenes
  childId              String
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  child                ChildProfile    @relation(fields: [childId], references: [id])
  assets               GeneratedAsset[]
  pages                Page[]
}

model Page {
  id            String @id @default(cuid())
  storyId       String
  story         Story  @relation(fields: [storyId], references: [id])
  pageNumber    Int
  text          String
  illustration  String?
}

model GeneratedAsset {
  id        String   @id @default(cuid())
  type      String   @default("IMAGE")
  sceneId   String
  url       String?
  prompt    String?
  storyId   String
  createdAt DateTime @default(now())
  story     Story    @relation(fields: [storyId], references: [id])
}
